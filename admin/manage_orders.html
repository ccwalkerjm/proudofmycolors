<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="description" content="range of shopping including tee shirts and other items">
    <meta name="author" content="courserv">
    <link rel="shortcut icon" href="img/favicon.png">

    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


    <title>ProudOfMyColors</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="/js/html5shiv.js"></script>
      <script src="/js/respond.min.js"></script>
    <![endif]-->
    <!--Favicon  -->
    <link rel="apple-touch-icon" sizes="57x57" href="/img/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/img/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/img/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/img/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicons/favicon-16x16.png">
    <link rel="manifest" href="/img/favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <!--Favicon  -->
</head>

<body>

    <!-- begin:navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#clotheshop-navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>

            <div class="collapse navbar-collapse" id="clotheshop-navbar">
                <ul class="nav navbar-nav navbar-right" id="menu_items">
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
    </nav>
    <!-- end:navbar -->

    <!-- begin:content -->
    <div class="container">
        <!-- begin:logo -->
        <div class="row">
            <div class="col-md-6 col-sm-6 col-xs-6">
                <div class="logo">
                    <a href="index.html"><img src="/img/logos/Proud-O-My-Colours_TEXTONLY-02-02_small.png" class="img-responsive" alt="Proud Of My Colors"></a>
                </div>
            </div>
            <div class="col-md-6 col-sm-6 col-xs-6">
                <div class="account">
                    <ul>
                        <li id="your-account">
                        </li>
                        <li id="cart-status">
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- end:logo -->

        <!-- begin:nav-menus -->
        <div class="row">
            <div class="col-md-12">
                <div class="nav-menus">
                </div>
            </div>
        </div>
        <!-- end:nav-menus -->

        <!-- begin:article -->
        <div class="row">
            <!-- begin:sidebar -->
            <div class="col-md-3 col-sm-4 sidebar">
                <div class="row">
                    <div class="col-md-12">
                        <div class="widget" id="shoppingCartWidget">
                        </div>
                        <!-- break -->
                        <div class="widget" id="shoppingCartCheckout">
                        </div>
                    </div>
                </div>
            </div>
            <!-- end:sidebar -->

            <!-- begin:content -->
            <div class="col-md-9 col-sm-8 content vertical-line">
                <div class="row">
                    <div class="col-md-12">
                        <h3 id="content-header">Manage Orders</h3>
                        <form class="form-inline pull-right">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select class="form-control input-sm" id="status">
                                    <option value="">ALL</option>
                                    <option value="PENDING">PENDING PAYMENT</option>
                                    <option value="PAID_NOT_DELIVERED">PAID PENDING DELIVERY</option>
                                    <option value="PAID_BEING_DELIVERED">PAID BEING DELIVERED</option>
                                    <option value="PAID_AND_RECEIVED">PAID AND RECEIVED</option>
                                    <option value="CANCELLED">CANCELLED</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dateFrom">Date From</label>
                                <input type="date" class="form-control input-sm" id="dateFrom" />
                            </div>
                            <div class="form-group">
                                <label for="dateTo">Date To</label>
                                <input type="date" class="form-control input-sm" id="dateTo" />
                            </div>
                            <button type="button" class="btn btn-default" id="search">Search</button>
                        </form>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 product-container">
                        <table class="table" id="orders"></table>
                    </div>
                </div>
            </div>
            <!-- end:content -->
        </div>
        <!-- end:article -->

        <!-- begin:footer -->
        <div class="row footer">
            <div class="col-md-12 copyright">
                <div class="row">
                    <div class="col-md-6 col-sm-6 copyright-left">
                        <p>Copyright &copy; Proud Of My Colors 2016. All right reserved.</p>
                    </div>
                    <div class="col-md-6 col-sm-6 copyright-right">
                        <ul class="list-unstyled list-social">
                            <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                            <li><a href="https://www.facebook.com/proudofmycolors"><i class="fa fa-facebook-square"></i></a></li>

                            <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- end:copyright -->

    </div>
    <!-- end:content -->
    <!-- Modals -->
    <div id="productModal" class="modal fade" role="dialog"></div>
    <div class="loadingModal"></div>
    <!-- Modal -->
    <div id="orderModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" id="submit" class="btn btn-primary">Submit</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/masonry.pkgd.min.js"></script>
    <script src="/js/imagesloaded.pkgd.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/accounting.js"></script>
    <script src="/js/bootbox.js"></script>
    <!--aws-->
    <script src="/js/aws/jsbn.js"></script>
    <script src="/js/aws/jsbn2.js"></script>
    <script src="/js/aws/sjcl.js"></script>
    <script src="/js/aws/moment.min.js"></script>
    <script src="/js/aws/aws-cognito-sdk.min.js"></script>
    <script src="/js/aws/amazon-cognito-identity.min.js"></script>
    <script src="/js/aws/aws-sdk.min.js"></script>
    <!--Iron Rock Custom Library-->
    <script src="/js/courserv_web_services.js"></script>
    <script src="/js/index.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            const orderDetail =
                '<form class="form-horizontal"> <input type="hidden" id="customerId" value=""/> <input type="hidden" id="domainKey" value=""/> <input type="hidden" id="orderNo" value=""/> <div class="form-group"> <label class="control-label col-sm-4" for="status">Status:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="status" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="trackingNo">Tracking Number:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="trackingNo" placeholder="USPS Tracking Number"> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="items_amt">Items Amount:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="items_amt" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="tax_amt">Tax Amount:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="tax_amt" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="ship_amt">Shipping Amount:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="ship_amt" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="amt">Total Amount:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="amt" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="created">Time Created:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="created" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="timeUpdated">Updated Time:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="timeUpdated" readonly> </div></div><h4>Shipping Information</h4><div class="form-group"> <label class="control-label col-sm-4" for="shipping-name">Name:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="shipping-name" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="shipping-street">Street Name:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="shipping-street" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="shipping-city">City:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="shipping-city" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="shipping-state">State:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="shipping-state" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="shipping-zip">Zip Code:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="shipping-zip" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="shipping-country">Country:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="shipping-country" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4" for="shipping-countryCode">Country Code:</label> <div class="col-sm-8"> <input type="text" class="form-control" id="shipping-countryCode" readonly> </div></div><div class="form-group"> <label class="control-label col-sm-4">Items:</label> <div class="col-sm-8"> <table id="items"></table> </div></div></form>';
            const STATUS_PENDING = "PENDING";
            const STATUS_PAID_NOT_DELIVERED = "PAID_NOT_DELIVERED";
            const STATUS_WAITING_PICKUP = "WAITING_PICKUP";
            const STATUS_IN_TRANSIT = "IN_TRANSIT";
            const STATUS_DELIVERED = "DELIVERED";
            const STATUS_CANCELLED = "CANCELLED";

            var details_on = ">>>>>>>";
            var details_off = "Goods ET-AL";
            var fromDate = new Date(); //.toISOString().slice(0,10);
            var toDate = new Date(); //.toISOString().slice(0,10);
            fromDate.setMonth(fromDate.getMonth() - 1);
            toDate.setDate(toDate.getDate() + 2);
            $('#dateFrom').val(fromDate.toISOString().slice(0, 10));
            $('#dateTo').val(toDate.toISOString().slice(0, 10));

            initPage(function(err, obj) {
                manageOrders(obj);
            });

            function manageOrders(obj) {
                obj = obj ? obj : g_courserv_web_service; //
                setLoadingState(true);
                obj.manageOrders(g_domainKey, $('#dateFrom').val(), $('#dateTo').val(), function(err, items) {
                    setLoadingState(false);
                    if (err) {
                        display(err.message, err);
                        return;
                    }

                    var searchStatus = $('#status').val();
                    if (searchStatus) {
                        items = items.filter(function(x) {
                            if (x.status == searchStatus) {
                                return true;
                            } else {
                                return false;
                            }
                        });
                    }


                    items.sort(function(a, b) {
                        return parseFloat(b.created) - parseFloat(a.created);
                    });

                    _orders = items;

                    var $table = $('#orders').empty();
                    var $thead = $('<thead/>').append('<tr><th class="col-md-1">No</th><th  class="col-md-2">Date</th><th class="col-md-6">Goods</th><th  class="col-md-2">Status</th><th  class="col-md-1" style="text-align: right">Cost</th></tr>');
                    $table.append($thead);
                    var $tbody = $('<tbody/>');
                    $.each(items, function(idx, item) {
                        var $tr = $('<tr/>');
                        //created
                        var dt = new Date(item.created);
                        $tr.append('<td>' + item.orderNo + '</td>');
                        $tr.append('<td>' + moment(dt).format('YYYY-MM-DD') + '</td>');
                        $tr.append('<td><a class="details" href="#" id="' + item.orderNo + '">' + details_off + '</a><div></div></td>');
                        $tr.append('<td>' + item.status + '</td>');
                        $tr.append('<td style="text-align: right">' + accounting.formatMoney(item.amt) + '</td>');


                        $tbody.append($tr);
                    });
                    $table.append($tbody);

                });
            }

            $('#search').click(function() {
                manageOrders();
            });

            $('#orders').on('click', '.details', function(e) {
                e.preventDefault();
                var $this = $(this);
                var orderNo = e.target.id;

                var selectOrder = _orders.find(function(x) {
                    return x.orderNo === orderNo;
                });

                var $modal = $('#orderModal');

                var $body = $modal.find('.modal-body').html(orderDetail);
                $modal.find('.modal-title').html('Order Details');

                var $table = $modal.find('#items').addClass('table');
                $('<thead/>').append('<tr><th>No</th><th>Name</th><th style="text-align: right">Price</th><th>Qty</th><th style="text-align: right">Total</th></tr>').appendTo($table);
                var $tbody = $('<tbody/>');

                $.each(JSON.parse(selectOrder.items), function(idx, x) {
                    $tbody.append('<tr><td>' + (idx + 1) +
                        '</td><td>' + x.M.name.S +
                        '</td><td style="text-align: right">' + accounting.formatMoney(x.M.amt.N) +
                        '</td><td>' + x.M.qty.N +
                        '</td><td style="text-align: right">' + accounting.formatMoney(x.M.amt.N * x.M.qty.N) + '</td></tr>');
                    $tbody.appendTo($table);
                });


                $body.find('#amt').val(accounting.formatMoney(selectOrder.amt));

                var created = new Date(selectOrder.created);
                var updated = new Date(selectOrder.timeUpdated || selectOrder.created);
                $body.find('#created').val(created);
                $body.find('#items_amt').val(accounting.formatMoney(selectOrder.items_amt));
                $body.find('#customerId').val(selectOrder.customerId);
                $body.find('#domainKey').val(selectOrder.domainKey);
                $body.find('#orderNo').val(selectOrder.orderNo);
                $body.find('#status').val(selectOrder.status);
                $body.find('#trackingNo').val(selectOrder.trackingNo);
                $body.find('#timeUpdated').val(updated);
                $body.find('#ship_amt').val(accounting.formatMoney(selectOrder.ship_amt));
                $body.find('#tax_amt').val(accounting.formatMoney(selectOrder.tax_amt));
                $body.find('#shipping-city').val(selectOrder.shippingAddress.city.S);
                $body.find('#shipping-country').val(selectOrder.shippingAddress.country.S);
                $body.find('#shipping-countryCode').val(selectOrder.shippingAddress.countryCode.S);
                $body.find('#shipping-name').val(selectOrder.shippingAddress.name.S);
                $body.find('#shipping-state').val(selectOrder.shippingAddress.state.S);
                $body.find('#shipping-street').val(selectOrder.shippingAddress.street.S);
                $body.find('#shipping-zip').val(selectOrder.shippingAddress.zip.N);

                //STATUS_PAID_NOT_DELIVERED
                var $trackingNo = $body.find('#trackingNo');
                $trackingNo.prop("readonly", selectOrder.status !== STATUS_PAID_NOT_DELIVERED);

                $modal.modal('show');
            })

            $('#orderModal').on('click', '#submit', function() {
                //domainKey, trackingNo
                var $modal = $('#orderModal');
                var req = {};
                req.domainKey = g_domainKey;
                req.orderNo = $modal.find('#orderNo').val();
                req.trackingNo = $modal.find('#trackingNo').val();

                g_courserv_web_service.initTracking(req, function(err, data) {
                    $modal.modal('hide');
                    manageOrders();
                });
            })


        });
    </script>

</body>

</html>
